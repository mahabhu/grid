<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid of Buttons</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(96, 5px);
            grid-gap: 0px;
        }
        .grid button {
            width: 5px;
            height: 5px;
            background-color: white;
            border: none;
            padding: 0;
            box-sizing: border-box;
            cursor: pointer;
        }
        #resetButton, #downloadButton {
            margin-top: 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="grid" id="grid"></div>
    <button id="resetButton">Reset Grid</button>
    <button id="downloadButton">Download as PNG</button>
    <script>
        const grid = document.getElementById('grid');
        const cols = 96;
        const rows = 192;
        const gridSize = cols * rows;

        // Get the saved state from localStorage, if it exists
        const savedGridState = localStorage.getItem('gridState');
        const gridState = savedGridState ? JSON.parse(savedGridState) : new Array(gridSize).fill('white');

        // Create the grid and set button colors based on the saved state
        for (let i = 0; i < gridSize; i++) {
            const button = document.createElement('button');
            button.style.backgroundColor = gridState[i];
            button.addEventListener('click', () => {
                const newColor = button.style.backgroundColor === 'black' ? 'white' : 'black';
                button.style.backgroundColor = newColor;
                gridState[i] = newColor;
                saveGridState();
            });
            grid.appendChild(button);
        }

        // Save the current grid state to localStorage
        function saveGridState() {
            localStorage.setItem('gridState', JSON.stringify(gridState));
        }

        // Reset all buttons to white and save the new state
        document.getElementById('resetButton').addEventListener('click', () => {
            gridState.fill('white');
            document.querySelectorAll('.grid button').forEach(button => {
                button.style.backgroundColor = 'white';
            });
            saveGridState();
        });

        // Convert the grid to a PNG and download it
        document.getElementById('downloadButton').addEventListener('click', () => {
            const canvas = document.createElement('canvas');
            canvas.width = cols * 5; // 96 * 5 = 480
            canvas.height = rows * 5; // 192 * 5 = 960
            const ctx = canvas.getContext('2d');

            // Draw each 5x5 pixel block onto the canvas
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const color = gridState[row * cols + col];
                    ctx.fillStyle = color;
                    ctx.fillRect(col * 5, row * 5, 5, 5);
                }
            }

            // Create a PNG and download it
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'grid.png';
                a.click();
                URL.revokeObjectURL(url);
            });
        });
    </script>
</body>
</html>